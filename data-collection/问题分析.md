# CloudBrush API æ•°æ®é‡‡é›† - é—®é¢˜åˆ†æ

## ğŸ” é—®é¢˜å‘ç°

ç»è¿‡æµ‹è¯•ï¼ŒCloudBrush API ä½¿ç”¨äº† **Laravel åŠ å¯†æœºåˆ¶**æ¥ä¿æŠ¤è¿”å›çš„æ•°æ®ã€‚

### API å“åº”ç»“æ„

```
è¯·æ±‚: GET /class/action.php?api=queryDict&cnChar=...
å“åº”: "eyJpdiI6Ikc4eVhJMHJ2..."ï¼ˆBase64 ç¼–ç çš„ JSONï¼‰

Base64 è§£ç å:
{
  "iv": "G8yXI0rvMtyVvisQyufymg==",          # åˆå§‹åŒ–å‘é‡
  "value": "gEQqf1Pwp0W3F7wbqxBLO0YKul...",   # AES-256-CBC åŠ å¯†çš„æ•°æ®
  "mac": "38d1fbfe27009d318fb01529618e9a19..." # æ¶ˆæ¯è®¤è¯ç 
}
```

### åŠ å¯†æ–¹å¼

- **ç®—æ³•**: AES-256-CBC
- **æ¡†æ¶**: Laravel Encryption
- **éœ€è¦**: `APP_KEY`ï¼ˆ32 å­—èŠ‚å¯†é’¥ï¼‰

## âŒ ä¸ºä»€ä¹ˆç›´æ¥ API é‡‡é›†å¤±è´¥

1. **æ•°æ®åŠ å¯†**: API è¿”å›çš„æ•°æ®æ˜¯åŠ å¯†çš„ï¼Œæ— æ³•ç›´æ¥è¯»å–å›¾ç‰‡ URL
2. **éœ€è¦å¯†é’¥**: å¿…é¡»æœ‰åº”ç”¨çš„ `APP_KEY` æ‰èƒ½è§£å¯†æ•°æ®
3. **å¯†é’¥ä½ç½®**: `APP_KEY` é€šå¸¸ç¡¬ç¼–ç åœ¨ App å†…éƒ¨

## âœ… å¯è¡Œçš„è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: ä½¿ç”¨æŠ“åŒ…æ–¹å¼ï¼ˆæ¨èï¼‰

é€šè¿‡ mitmproxy æ‹¦æˆª App çš„ç½‘ç»œè¯·æ±‚ï¼Œç›´æ¥è·å–**è§£å¯†å**çš„æ•°æ®ã€‚

**ä¼˜ç‚¹**:
- âœ… ä¸éœ€è¦ APP_KEY
- âœ… å¯ä»¥è·å– App å®é™…æ˜¾ç¤ºçš„å›¾ç‰‡ URL
- âœ… å·²æœ‰ç°æˆè„šæœ¬ `enhanced_collector.py`

**æ­¥éª¤**:

```bash
# 1. å¯åŠ¨ mitmproxy
cd /Volumes/thinkplus-1T/my-github/handwriting-backend/data-collection
mitmweb -s enhanced_collector.py -p 8080

# 2. é…ç½® iPhone ä»£ç†
#    - è¿æ¥åŒä¸€ WiFi
#    - è®¾ç½®ä»£ç†: ä½ çš„ç”µè„‘ IP:8080
#    - å®‰è£… mitmproxy è¯ä¹¦

# 3. åœ¨ App ä¸­æµè§ˆæ±‰å­—
#    - æ¯ä¸ªå­—åœç•™ 1-2 ç§’
#    - è„šæœ¬ä¼šè‡ªåŠ¨ä¿å­˜å›¾ç‰‡
```

### æ–¹æ¡ˆ 2: åç¼–è¯‘ App è·å– APP_KEY

ä» App ä¸­æå– `APP_KEY`ï¼Œç„¶ååœ¨è„šæœ¬ä¸­è§£å¯†æ•°æ®ã€‚

**æ­¥éª¤**:

1. **ä¸‹è½½ IPA æ–‡ä»¶**
   - ä½¿ç”¨ iMazing/iTunes ä» iPhone ä¸‹è½½å·²å®‰è£…çš„ CloudBrush.app

2. **åç¼–è¯‘**
   - ä½¿ç”¨ Hopper Disassembler / IDA Pro
   - æœç´¢ "APP_KEY"ã€"encryption" ç­‰å…³é”®å­—

3. **ä¿®æ”¹è„šæœ¬**
   - åœ¨ `api_collector.py` ä¸­æ·»åŠ è§£å¯†é€»è¾‘

**ç¤ºä¾‹ä»£ç **:

```python
from Crypto.Cipher import AES
from Crypto.Util.Padding import unpad
import base64
import json

def decrypt_laravel(encrypted_str, app_key):
    """è§£å¯† Laravel åŠ å¯†çš„æ•°æ®"""
    # è§£æåŠ å¯†ç»“æ„
    encrypted_json = json.loads(base64.b64decode(encrypted_str))

    iv = base64.b64decode(encrypted_json['iv'])
    value = base64.b64decode(encrypted_json['value'])

    # AES-256-CBC è§£å¯†
    cipher = AES.new(base64.b64decode(app_key), AES.MODE_CBC, iv)
    decrypted = unpad(cipher.decrypt(value), AES.block_size)

    return json.loads(decrypted.decode('utf-8'))

# ä½¿ç”¨
APP_KEY = "base64:xxxxx..."  # ä» App ä¸­æå–
decrypted_data = decrypt_laravel(api_response, APP_KEY)
```

### æ–¹æ¡ˆ 3: ä» Charles è·å–è§£å¯†åçš„æ•°æ®

å¦‚æœ Charles èƒ½çœ‹åˆ°è§£å¯†åçš„æ•°æ®ï¼ˆæœ‰äº› App ä¼šåœ¨å®¢æˆ·ç«¯è§£å¯†ï¼‰ï¼Œç›´æ¥ä» Charles å¤åˆ¶å›¾ç‰‡ URLã€‚

**æ£€æŸ¥æ–¹æ³•**:

1. åœ¨ Charles ä¸­æ‰¾åˆ° API å“åº”
2. æŸ¥çœ‹ Response å†…å®¹
3. å¦‚æœèƒ½çœ‹åˆ° JSON æ•°æ®ï¼ˆè€Œä¸æ˜¯åŠ å¯†å­—ç¬¦ä¸²ï¼‰ï¼Œè¯´æ˜å¯ä»¥ç›´æ¥ä½¿ç”¨

## ğŸ¯ æ¨èæ–¹æ¡ˆ

### ğŸ‘‰ æ–¹æ¡ˆ 1: æŠ“åŒ…æ–¹å¼ï¼ˆæœ€ç®€å•ï¼‰

å› ä¸ºï¼š
1. âœ… ä¸éœ€è¦åç¼–è¯‘
2. âœ… ä¸éœ€è¦æ‰¾ APP_KEY
3. âœ… å·²æœ‰ç°æˆè„šæœ¬
4. âœ… å¯ä»¥è·å–çœŸå®çš„å›¾ç‰‡ URL

**ç¼ºç‚¹**:
- âš ï¸ éœ€è¦æ‰‹åŠ¨æ“ä½œï¼ˆåœ¨ App ä¸­æµè§ˆï¼‰
- âš ï¸ é‡‡é›†é€Ÿåº¦è¾ƒæ…¢ï¼ˆçº¦ 1-2 å°æ—¶ï¼‰

### æ‰§è¡Œæ­¥éª¤

```bash
# 1. å®‰è£…ä¾èµ–
cd /Volumes/thinkplus-1T/my-github/handwriting-backend
source venv/bin/activate
pip install mitmproxy

# 2. å¯åŠ¨æŠ“åŒ…
cd data-collection
mitmweb -s enhanced_collector.py -p 8080

# 3. é…ç½® iPhone
#    è®¾ç½® â†’ Wi-Fi â†’ é…ç½®ä»£ç† â†’ æ‰‹åŠ¨
#    æœåŠ¡å™¨: <ä½ çš„ç”µè„‘IP>
#    ç«¯å£: 8080

# 4. å®‰è£…è¯ä¹¦
#    Safari è®¿é—®: mitm.it
#    å®‰è£…å¹¶ä¿¡ä»»è¯ä¹¦

# 5. å¼€å§‹é‡‡é›†
#    æ‰“å¼€ CloudBrush App
#    æ…¢æ…¢æµè§ˆæ±‰å­—ï¼Œæ¯ä¸ªåœç•™ 1-2 ç§’
#    è„šæœ¬ä¼šè‡ªåŠ¨ä¿å­˜å›¾ç‰‡
```

### é¢„è®¡æ—¶é—´

- **3500 ä¸ªæ±‰å­—**
- **æ¯ä¸ª 2 ç§’** = çº¦ 2 å°æ—¶
- **å¯ä»¥åˆ†æ‰¹è¿›è¡Œ**ï¼ˆè„šæœ¬æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼‰

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

é€‰æ‹©ä¸€ä¸ªæ–¹æ¡ˆï¼š

### é€‰é¡¹ A: ä½¿ç”¨æŠ“åŒ…æ–¹å¼ï¼ˆæ¨èï¼‰
```bash
cd /Volumes/thinkplus-1T/my-github/handwriting-backend/data-collection
source ../venv/bin/activate
pip install mitmproxy
mitmweb -s enhanced_collector.py -p 8080
```

### é€‰é¡¹ B: åç¼–è¯‘ Appï¼ˆéœ€è¦æŠ€æœ¯ï¼‰
1. ä¸‹è½½ CloudBrush IPA
2. ä½¿ç”¨ Hopper åç¼–è¯‘
3. æœç´¢ APP_KEY
4. ä¿®æ”¹ `api_collector.py` æ·»åŠ è§£å¯†é€»è¾‘

### é€‰é¡¹ C: æ£€æŸ¥ Charles æ˜¯å¦æœ‰è§£å¯†æ•°æ®
1. åœ¨ Charles ä¸­æ‰¾åˆ° API è¯·æ±‚
2. æŸ¥çœ‹ Response æ˜¯å¦æ˜¯æ˜æ–‡ JSON
3. å¦‚æœæ˜¯ï¼Œç›´æ¥ä» Charles å¤åˆ¶å›¾ç‰‡ URL

---

**æˆ‘çš„å»ºè®®**: ä½¿ç”¨æ–¹æ¡ˆ 1ï¼ˆæŠ“åŒ…ï¼‰ï¼Œå› ä¸ºæœ€ç®€å•å¯è¡Œã€‚éœ€è¦æˆ‘å¸®ä½ è®¾ç½®æŠ“åŒ…ç¯å¢ƒå—ï¼Ÿ
