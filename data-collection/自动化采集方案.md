# è‡ªåŠ¨åŒ–é‡‡é›†æ±‰å­—å›¾ç‰‡ - å®Œæ•´æ–¹æ¡ˆ

## ğŸ¯ é—®é¢˜åˆ†æ

1. âœ… API token æœ‰æ•ˆ
2. âŒ API å“åº”è¢« Laravel AES-256-CBC åŠ å¯†
3. âœ… å›¾ç‰‡ URL æœ¬èº«æ˜¯å…¬å¼€çš„ï¼ˆå¯ç›´æ¥è®¿é—®ï¼‰
4. âœ… Charles å¯ä»¥æ•è· App å‘å‡ºçš„å›¾ç‰‡è¯·æ±‚

## ğŸ’¡ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ A: ä½¿ç”¨ mitmproxy è‡ªåŠ¨é‡‡é›†ï¼ˆæ¨èï¼‰

é€šè¿‡ä»£ç†æ‹¦æˆª App çš„æµé‡ï¼Œè‡ªåŠ¨è®°å½•æ‰€æœ‰å›¾ç‰‡ URLï¼Œç„¶åæ‰¹é‡ä¸‹è½½ã€‚

#### ä¼˜ç‚¹
- âœ… å®Œå…¨è‡ªåŠ¨åŒ–
- âœ… ä¸éœ€è¦è§£å¯† API å“åº”
- âœ… ä¸éœ€è¦æ‰‹åŠ¨æ“ä½œ
- âœ… å¯ä»¥æŒç»­è¿è¡Œ

#### æ‰§è¡Œæ­¥éª¤

**1. å®‰è£… mitmproxy**

```bash
cd /Volumes/thinkplus-1T/my-github/handwriting-backend
source venv/bin/activate
pip install mitmproxy
```

**2. å¯åŠ¨æ™ºèƒ½é‡‡é›†å™¨**

```bash
cd data-collection
mitmweb -s smart_collector.py -p 8080
```

**3. é…ç½® iPhone**

- è®¾ç½® â†’ Wi-Fi â†’ é…ç½®ä»£ç†
- æœåŠ¡å™¨: `<ä½ çš„ç”µè„‘IP>`
- ç«¯å£: `8080`

**4. å®‰è£…è¯ä¹¦**

- Safari è®¿é—®: `mitm.it`
- ä¸‹è½½å¹¶å®‰è£…è¯ä¹¦
- è®¾ç½® â†’ é€šç”¨ â†’ å…³äº â†’ è¯ä¹¦ä¿¡ä»»è®¾ç½® â†’ å¯ç”¨å®Œå…¨ä¿¡ä»»

**5. åœ¨ App ä¸­æµè§ˆæ±‰å­—**

- æ‰“å¼€ CloudBrush App
- æµè§ˆä¸åŒçš„æ±‰å­—ï¼ˆæŒ‰éƒ¨é¦–/ç¬”ç”»/æœç´¢ï¼‰
- æ¯ä¸ªå­—åœç•™ 1-2 ç§’
- è„šæœ¬ä¼šè‡ªåŠ¨è®°å½•æ‰€æœ‰å›¾ç‰‡ URL

**6. æ‰¹é‡ä¸‹è½½**

å½“ä½ æµè§ˆäº†è¶³å¤Ÿå¤šçš„å­—åï¼Œåœæ­¢ mitmproxyï¼Œç„¶åï¼š

```bash
# URL å·²è‡ªåŠ¨ä¿å­˜åˆ° auto_extracted_urls.txt
python3 download_from_urls.py auto_extracted_urls.txt
```

#### é¢„è®¡æ—¶é—´

- **3500 ä¸ªæ±‰å­—**
- **æ¯ä¸ª 2 ç§’** = çº¦ 2 å°æ—¶
- **å¯ä»¥åˆ†æ‰¹è¿›è¡Œ**ï¼Œæ¯æ¬¡ 100-200 å­—

---

### æ–¹æ¡ˆ B: åç¼–è¯‘ App è·å–è§£å¯†å¯†é’¥ï¼ˆå¤æ‚ï¼‰

å¦‚æœä½ æƒ³è¦å®Œå…¨è‡ªåŠ¨åŒ–ï¼ˆä¸éœ€è¦åœ¨ App ä¸­æµè§ˆï¼‰ï¼Œéœ€è¦ï¼š

1. **ä¸‹è½½ CloudBrush IPA**
   - ä½¿ç”¨ iMazing ä» iPhone ä¸‹è½½

2. **åç¼–è¯‘æå– APP_KEY**
   - ä½¿ç”¨ Hopper Disassembler
   - æœç´¢ "APP_KEY", "encrypt", "decrypt"

3. **å®ç°è§£å¯†é€»è¾‘**
   - åœ¨ Python ä¸­å®ç° Laravel è§£å¯†
   - ä¿®æ”¹ `api_collector.py` æ·»åŠ è§£å¯†åŠŸèƒ½

4. **æ‰¹é‡æŸ¥è¯¢å’Œä¸‹è½½**

```python
from Crypto.Cipher import AES
from Crypto.Util.Padding import unpad
import base64
import json

def decrypt_laravel(encrypted_str, app_key):
    """è§£å¯† Laravel å“åº”"""
    data = json.loads(base64.b64decode(encrypted_str))

    iv = base64.b64decode(data['iv'])
    value = base64.b64decode(data['value'])

    # APP_KEY éœ€è¦ä» App ä¸­æå–
    key = base64.b64decode(app_key.replace('base64:', ''))

    cipher = AES.new(key, AES.MODE_CBC, iv)
    decrypted = unpad(cipher.decrypt(value), AES.block_size)

    return json.loads(decrypted.decode('utf-8'))
```

**ç¼ºç‚¹**:
- âš ï¸ éœ€è¦é€†å‘å·¥ç¨‹æŠ€èƒ½
- âš ï¸ å¯èƒ½è¿å App ä½¿ç”¨åè®®
- âš ï¸ APP_KEY å¯èƒ½ä¼šå˜åŒ–

---

### æ–¹æ¡ˆ C: ä» Charles æ‰¹é‡å¯¼å‡ºï¼ˆå½“å‰æ–¹æ¡ˆï¼‰

ç»§ç»­ä½¿ç”¨ Charlesï¼Œä½†ä¼˜åŒ–å·¥ä½œæµã€‚

#### æ‰§è¡Œæ­¥éª¤

**1. åœ¨ App ä¸­æµè§ˆ 100 ä¸ªæ±‰å­—**
   - å¼€å¯ Charles å½•åˆ¶
   - å¿«é€Ÿæµè§ˆä¸åŒçš„å­—

**2. å¯¼å‡º Charles Session**
   - File â†’ Export Session â†’ JSON

**3. æå– URL å¹¶ä¸‹è½½**

```bash
python3 extract_urls_from_charles.py session.json
python3 download_from_urls.py extracted_urls.txt
```

**4. é‡å¤æ­¥éª¤ 1-3**

---

## ğŸš€ æ¨èæ‰§è¡Œæ–¹æ¡ˆ

### ç«‹å³å¯ç”¨: æ–¹æ¡ˆ Aï¼ˆmitmproxyï¼‰

1. **ç°åœ¨å°±å¼€å§‹**:

```bash
cd /Volumes/thinkplus-1T/my-github/handwriting-backend
source venv/bin/activate
pip install mitmproxy

cd data-collection
mitmweb -s smart_collector.py -p 8080
```

2. **é…ç½® iPhone ä»£ç†** (æŒ‡å‘ä½ çš„ç”µè„‘)

3. **åœ¨ App ä¸­æµè§ˆæ±‰å­—** (è‡ªåŠ¨é‡‡é›†)

4. **æ‰¹é‡ä¸‹è½½**:

```bash
python3 download_from_urls.py auto_extracted_urls.txt
```

### ä¼˜åŠ¿

- âœ… å®Œå…¨è‡ªåŠ¨åŒ–é‡‡é›† URL
- âœ… å¯ä»¥è¾¹æµè§ˆè¾¹ä¸‹è½½
- âœ… æ”¯æŒæ–­ç‚¹ç»­ä¼ 
- âœ… ä¸éœ€è¦æ‰‹åŠ¨å¯¼å‡º Charles

---

## ğŸ“Š è¿›åº¦è·Ÿè¸ª

å½“å‰è¿›åº¦: **12 / 3500 (0.34%)**

é¢„è®¡å®Œæˆæ—¶é—´ï¼ˆæ–¹æ¡ˆ Aï¼‰:
- **å¿«é€Ÿæµè§ˆ**: çº¦ 2 å°æ—¶
- **å¯åˆ† 10 æ¬¡å®Œæˆ**: æ¯æ¬¡ 20 åˆ†é’Ÿ

---

## â“ å¸¸è§é—®é¢˜

### Q: mitmproxy å’Œ Charles æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

A:
- Charles: æ‰‹åŠ¨æ“ä½œï¼Œéœ€è¦å¯¼å‡º session
- mitmproxy: å¯ä»¥ç¼–ç¨‹ï¼Œè‡ªåŠ¨è®°å½• URL

### Q: å›¾ç‰‡ä¼šè‡ªåŠ¨ä¸‹è½½å—ï¼Ÿ

A: ä¸ä¼šã€‚mitmproxy åªè®°å½• URLï¼Œéœ€è¦è¿è¡Œ `download_from_urls.py` æ¥æ‰¹é‡ä¸‹è½½

### Q: å¯ä»¥åŒæ—¶é‡‡é›†å’Œä¸‹è½½å—ï¼Ÿ

A: å¯ä»¥ï¼ä¿®æ”¹ `smart_collector.py` æ·»åŠ å®æ—¶ä¸‹è½½åŠŸèƒ½

---

## ğŸ“ ä¸‹ä¸€æ­¥

é€‰æ‹©ä¸€ä¸ªæ–¹æ¡ˆå¼€å§‹æ‰§è¡Œï¼š

- **æ–¹æ¡ˆ A**: ç«‹å³å¯åŠ¨ mitmproxyï¼ˆæ¨èï¼‰
- **æ–¹æ¡ˆ C**: ç»§ç»­ä½¿ç”¨ Charlesï¼ˆå·²éªŒè¯å¯ç”¨ï¼‰
